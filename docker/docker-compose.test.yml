version: '3.2'
services:
    sut:
        build:
            args:
                image_name: $IMAGE_NAME
            context: ../
            dockerfile: docker/Dockerfile.test
            cache_from:
                - $CACHE_TAG
                - $IMAGE_NAME
        volumes:
            - ../tests:/usr/local/airflow/tests
        entrypoint: /bin/sh -c
        command:
            - pytest && flake8 .
